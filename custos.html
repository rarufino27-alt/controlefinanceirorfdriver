<!DOCTYPE html><html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Custos Diários – Operação (Modo Crise)</title>  <style>
    :root{
      --bg:#0f1115;--card:#181b22;--text:#eaeaf0;--muted:#9aa0aa;
      --accent:#f5c542;--danger:#ff5c5c;--ok:#2ecc71;--warn:#f39c12;
    }
    *{box-sizing:border-box;font-family:Inter,Arial,sans-serif}
    body{margin:0;background:var(--bg);color:var(--text)}
    header{padding:16px;text-align:center;border-bottom:1px solid #222}
    header h1{margin:0;color:var(--accent)}
    header p{margin:6px 0 0;font-size:.85rem;color:var(--muted)}
    .crise{background:#2b0f14;color:#ffb3b3;border:1px solid #ff5c5c;padding:10px;border-radius:10px;text-align:center;font-weight:700}
    main{max-width:480px;margin:auto;padding:16px;display:flex;flex-direction:column;gap:16px}
    .card{background:var(--card);border-radius:14px;padding:16px;box-shadow:0 8px 24px rgba(0,0,0,.35)}
    h2{margin:0 0 10px;color:var(--accent)}
    input{width:100%;padding:10px;border-radius:10px;border:none;background:#222634;color:var(--text);margin-bottom:8px}
    button{width:100%;padding:10px;border-radius:10px;border:none;background:var(--accent);color:#000;font-weight:700;cursor:pointer}
    .ok{color:var(--ok)}
    .bad{color:var(--danger)}
    ul{list-style:none;padding:0;margin:0}
    li{padding:6px 0;border-bottom:1px solid #2a2e3d;font-size:.9rem}
    footer{text-align:center;font-size:.75rem;color:var(--muted);padding:12px}
  </style></head>
<body><header>
  <h1>Custos Diários</h1>
  <p>Proteção automática de caixa</p>
</header><main>  <div id="alertaCrise" style="display:none" class="crise">
    ⚠️ MODO CRISE ATIVO – pagamentos bloqueados hoje
  </div>  <div class="card">
    <h2>Dados do Dia</h2>
    <input id="faturamento" type="number" placeholder="Faturamento bruto do dia" />
    <input id="km" type="number" placeholder="KM rodados hoje" />
    <input id="custoExtra" type="number" placeholder="Custos extras (pedágio, taxas)" />
    <button onclick="processar()">Processar Operação</button>
  </div>  <div class="card">
    <h2>Resultado do Dia</h2>
    <ul id="resultado"></ul>
  </div>  <div class="card">
    <h2>IA – Avaliação Conservadora</h2>
    <div id="ia"></div>
  </div>  <div class="card">
    <h2>Histórico (90 dias)</h2>
    <ul id="historico"></ul>
  </div></main><footer>
  <a href="index.html" style="color:#f5c542;text-decoration:none">← Voltar ao Dashboard</a>
</footer><script>
const $ = id => document.getElementById(id);

function processar(){
  const cfg = JSON.parse(localStorage.getItem('cfg'));
  if(!cfg) return alert('Configure o custo por KM no dashboard');

  const bruto = Number(faturamento.value||0);
  const kmRodado = Number(km.value||0);
  const extra = Number(custoExtra.value||0);

  const custoKm = kmRodado * cfg.custoKm;
  const custoTotal = custoKm + extra;
  const liquido = bruto - custoTotal;

  resultado.innerHTML = '';
  resultado.innerHTML += `<li>Custo por KM: R$ ${custoKm.toFixed(2)}</li>`;
  resultado.innerHTML += `<li>Custos extras: R$ ${extra.toFixed(2)}</li>`;
  resultado.innerHTML += `<li><strong>Resultado líquido: R$ ${liquido.toFixed(2)}</strong></li>`;

  const crise = liquido <= 0 || liquido < 150;
  localStorage.setItem('modoCrise', crise ? 'true' : 'false');
  document.getElementById('alertaCrise').style.display = crise ? 'block' : 'none';

  gerarIA(bruto, custoTotal, liquido, kmRodado, crise);

  const resumo = { data: new Date().toISOString(), liquido, ok: !crise, ia: ia.innerText, crise };
  localStorage.setItem('ultimoResumo', JSON.stringify(resumo));

  let hist = JSON.parse(localStorage.getItem('historico') || '[]');
  hist.push({ data: resumo.data, bruto, km: kmRodado, custo: custoTotal, liquido, crise });
  if(hist.length > 90) hist = hist.slice(hist.length - 90);
  localStorage.setItem('historico', JSON.stringify(hist));

  renderHistorico();
}

function gerarIA(bruto, custo, liquido, km, crise){
  let msg='';
  const custoPerc = bruto>0 ? (custo/bruto)*100 : 100;

  if(crise){
    msg='Modo crise ativado. Hoje é proibido pagar dívidas ou assumir compromissos.';
  } else if(custoPerc>60){
    msg='Custo elevado. Amanhã priorize corridas mais rentáveis.';
  } else {
    msg='Dia saudável. Operação dentro do controle.';
  }
  ia.innerText = msg;
}

function renderHistorico(){
  const ul = $('historico'); ul.innerHTML = '';
  const hist = JSON.parse(localStorage.getItem('historico') || '[]').slice().reverse();
  hist.forEach(d=>{
    const data = new Date(d.data).toLocaleDateString('pt-BR');
    ul.innerHTML += `<li>${data} • Líquido R$ ${d.liquido.toFixed(2)} ${d.crise?'⚠️':''}</li>`;
  });
}

renderHistorico();
</script></body>
</html>