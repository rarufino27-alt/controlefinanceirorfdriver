<!DOCTYPE html><html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Custos do Veículo • Gestão por KM</title>  <style>
    :root{
      --bg:#0f1115;--card:#181b22;--text:#eaeaf0;--muted:#9aa0aa;
      --accent:#f5c542;--danger:#ff5c5c;--ok:#2ecc71;--warn:#f39c12;
    }
    *{box-sizing:border-box;font-family:Inter,Arial,sans-serif}
    body{margin:0;background:var(--bg);color:var(--text)}
    header{padding:16px;text-align:center;border-bottom:1px solid #222}
    header h1{margin:0;color:var(--accent)}
    header p{margin:6px 0 0;font-size:.85rem;color:var(--muted)}
    main{max-width:540px;margin:auto;padding:16px;display:flex;flex-direction:column;gap:16px}
    .card{background:var(--card);border-radius:14px;padding:16px;box-shadow:0 8px 24px rgba(0,0,0,.35)}
    h2{margin:0 0 10px;color:var(--accent)}
    input,select{width:100%;padding:10px;border-radius:10px;border:none;background:#222634;color:var(--text);margin-bottom:8px}
    button{width:100%;padding:10px;border-radius:10px;border:none;background:var(--accent);color:#000;font-weight:700;cursor:pointer}
    .row{display:flex;justify-content:space-between;margin:6px 0}
    ul{list-style:none;padding:0;margin:0}
    li{padding:6px 0;border-bottom:1px solid #2a2e3d;font-size:.9rem}
    footer{text-align:center;font-size:.75rem;color:var(--muted);padding:12px}
  </style></head>
<body><header>
  <h1>Custos do Veículo</h1>
  <p>Controle mecânico e financeiro integrado</p>
</header><main>  <!-- DADOS DO VEÍCULO -->  <div class="card">
    <h2>Veículo</h2>
    <input id="marca" placeholder="Marca" />
    <input id="modelo" placeholder="Modelo" />
    <input id="ano" placeholder="Ano" />
    <input id="kmAtual" type="number" placeholder="KM atual do veículo" />
    <button onclick="salvarVeiculo()">Salvar Veículo</button>
  </div>  <!-- DESPESAS OPERACIONAIS / MECÂNICAS -->  <div class="card">
    <h2>Despesas Mecânicas</h2>
    <select id="tipoServico">
      <option value="preventiva">Manutenção preventiva</option>
      <option value="corretiva">Manutenção corretiva (descrição manual)</option>
      <option value="pneu">Pneus</option>
      <option value="pastilha">Pastilha de freio</option>
      <option value="oleo_freio">Óleo de freio</option>
      <option value="oleo_cambio">Troca de óleo de câmbio automático</option>
      <option value="outro">Outros</option>
    </select>
    <input id="descricaoServico" placeholder="Descrição (se aplicável)" />
    <input id="valorServico" type="number" placeholder="Valor pago no serviço" />
    <input id="kmServico" type="number" placeholder="KM atual do veículo" />
    <input id="autonomiaServico" type="number" placeholder="Autonomia do serviço (KM)" />
    <button onclick="registrarServico()">Registrar Serviço</button>
    <ul id="listaServicos"></ul>
  </div>  <!-- DESPESAS DE PAGAMENTO VEICULAR -->  <div class="card">
    <h2>Despesas de Pagamento Veicular</h2>
    <select id="tipoPagamento">
      <option value="ipva">IPVA</option>
      <option value="seguro">Seguro</option>
      <option value="vistoria_detran">Vistoria Detran</option>
      <option value="vistoria_gnv">Vistoria GNV</option>
      <option value="manutencao_gnv">Manutenção GNV</option>
      <option value="reteste_gnv">Reteste cilindro GNV</option>
      <option value="outro">Outros</option>
    </select>
    <input id="valorPagamento" type="number" placeholder="Valor pago" />
    <select id="formaPagamento">
      <option value="avista">À vista</option>
      <option value="parcelado">Cartão (parcelado)</option>
    </select>
    <input id="parcelas" type="number" placeholder="Quantidade de parcelas (se parcelado)" />
    <input id="vencimento" type="date" placeholder="Data do pagamento" />
    <input id="proximoPagamento" type="date" placeholder="Próximo vencimento (mensal/anual)" />
    <button onclick="registrarPagamentoVeicular()">Registrar Pagamento</button>
    <ul id="listaPagamentos"></ul>
  </div>  <!-- RESUMO POR KM -->  <div class="card">
    <h2>Custo Real por KM</h2>
    <div class="row"><span>Total serviços / KM</span><strong id="servKm">–</strong></div>
    <div class="row"><span><strong>Custo total / KM</strong></span><strong id="totalKm">–</strong></div>
  </div></main><footer>
  <a href="index.html" style="color:#f5c542;text-decoration:none">← Voltar ao Dashboard</a>
</footer><script>
const $ = id => document.getElementById(id);
const getArr = k => JSON.parse(localStorage.getItem(k)||'[]');
const setArr = (k,v) => localStorage.setItem(k, JSON.stringify(v));

function salvarVeiculo(){
  const v={marca:marca.value,modelo:modelo.value,ano:ano.value,km:Number(kmAtual.value)};
  localStorage.setItem('veiculo', JSON.stringify(v));
}

function registrarServico(){
  const kmAtual = Number(kmServico.value);
  const autonomia = Number(autonomiaServico.value);
  const kmFim = autonomia ? kmAtual + autonomia : null;

  const s={tipo:tipoServico.value,desc:descricaoServico.value,valor:Number(valorServico.value),kmInicio:kmAtual,kmFim};
  const arr=getArr('servicosVeiculo'); arr.push(s); setArr('servicosVeiculo',arr);
  renderServicos(); calcularKM();
}

function registrarPagamentoVeicular(){
  const p={tipo:tipoPagamento.value,valor:Number(valorPagamento.value),forma:formaPagamento.value,parcelas:Number(parcelas.value||1),vencimento:vencimento.value,proximo:proximoPagamento.value};
  const arr=getArr('pagamentosVeiculo'); arr.push(p); setArr('pagamentosVeiculo',arr);

  if(p.forma==='parcelado'){
    const div={descricao:`${p.tipo} veicular`,valor:p.valor/ p.parcelas,periodo:'mensal',parcelas:p.parcelas,inicio:p.vencimento};
    const d=getArr('registros'); d.push(div); setArr('registros',d);
  }

  renderPagamentos();
}

function renderServicos(){
  listaServicos.innerHTML='';
  getArr('servicosVeiculo').forEach(s=>{
    listaServicos.innerHTML+=`<li>${s.tipo} • R$ ${s.valor.toFixed(2)} • KM ${s.kmInicio}${s.kmFim?` → ${s.kmFim}`:''}</li>`;
  });
}

function renderPagamentos(){
  listaPagamentos.innerHTML='';
  getArr('pagamentosVeiculo').forEach(p=>{
    listaPagamentos.innerHTML+=`<li>${p.tipo} • R$ ${p.valor.toFixed(2)} • ${p.forma}</li>`;
  });
}

function calcularKM(){
  const serv=getArr('servicosVeiculo');
  const kmTotal=serv.reduce((s,x)=>x.kmFim? s+(x.kmFim-x.kmInicio):s,0);
  const valorTotal=serv.reduce((s,x)=>s+x.valor,0);

  if(kmTotal>0){
    const ckm=valorTotal/kmTotal;
    servKm.innerText='R$ '+ckm.toFixed(2);
    totalKm.innerText='R$ '+ckm.toFixed(2);
    localStorage.setItem('custoKmVeiculo', ckm.toFixed(4));
  }
}

renderServicos(); renderPagamentos(); calcularKM();
</script></body>
</html>