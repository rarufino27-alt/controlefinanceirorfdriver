<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Custos do Veículo • Gestão por KM</title>

  <style>
    :root{
      --bg:#0f1115;--card:#181b22;--text:#eaeaf0;--muted:#9aa0aa;
      --accent:#f5c542;--danger:#ff5c5c;--ok:#2ecc71;--warn:#f39c12;
    }
    *{box-sizing:border-box;font-family:Inter,Arial,sans-serif}
    body{margin:0;background:var(--bg);color:var(--text)}
    header{padding:16px;text-align:center;border-bottom:1px solid #222}
    header h1{margin:0;color:var(--accent)}
    header p{margin:6px 0 0;font-size:.85rem;color:var(--muted)}
    main{max-width:1200px;margin:auto;padding:16px;display:grid;grid-template-columns:1fr;gap:16px}

/* Tablets */
@media (min-width: 600px){
  main{grid-template-columns:1fr 1fr}
  main > .card:nth-child(1){grid-column:1 / -1}
}

/* Desktop */
@media (min-width: 1024px){
  main{grid-template-columns:repeat(3, 1fr)}
  main > .card:nth-child(1){gri
    .card{background:var(--card);border-radius:14px;padding:16px;box-shadow:0 8px 24px rgba(0,0,0,.35)}
    h2{margin:0 0 10px;color:var(--accent)}
    input,select{width:100%;padding:10px;border-radius:10px;border:none;background:#222634;color:var(--text);margin-bottom:8px}
    button{width:100%;padding:10px;border-radius:10px;border:none;background:var(--accent);color:#000;font-weight:700;cursor:pointer}
    .row{display:flex;justify-content:space-between;margin:6px 0}
    ul{list-style:none;padding:0;margin:0}
    li{padding:6px 0;border-bottom:1px solid #2a2e3d;font-size:.9rem}
    .ok{color:var(--ok)}
    .bad{color:var(--danger)}
    footer{text-align:center;font-size:.75rem;color:var(--muted);padding:12px}
  </style>
</head>
<body>

<header>
  <h1>Custos do Veículo</h1>
  <p>Descubra o custo real por KM e antecipe gastos</p>
</header>

<main>

  <!-- DADOS DO VEÍCULO -->
  <div class="card">
    <h2>Veículo</h2>
    <input id="marca" placeholder="Marca (ex: Chevrolet)" />
    <input id="modelo" placeholder="Modelo (ex: Prisma)" />
    <input id="ano" placeholder="Ano" />
    <input id="kmAtual" type="number" placeholder="KM atual do veículo" />
    <button onclick="salvarVeiculo()">Salvar Veículo</button>
  </div>

  <!-- CONSUMO DE COMBUSTÍVEL -->
  <div class="card">
    <h2>Consumo de Combustível</h2>
    <input id="kmRodado" type="number" placeholder="KM rodados no abastecimento" />
    <input id="litros" type="number" placeholder="Litros abastecidos" />
    <input id="valorComb" type="number" placeholder="Valor pago (R$)" />
    <button onclick="registrarCombustivel()">Registrar Consumo</button>
  </div>

  <!-- DESPESAS DO VEÍCULO -->
  <div class="card">
    <h2>Despesas do Veículo</h2>
    <select id="tipoDespesa">
      <option value="manutencao">Manutenção</option>
      <option value="preventiva">Preventiva</option>
      <option value="pneu">Pneus</option>
      <option value="seguro">Seguro</option>
      <option value="ipva">IPVA</option>
      <option value="outro">Outro</option>
    </select>
    <input id="valorDespesa" type="number" placeholder="Valor da despesa" />
    <input id="kmDespesa" type="number" placeholder="KM do veículo (opcional)" />
    <button onclick="registrarDespesa()">Registrar Despesa</button>
    <ul id="listaDespesas"></ul>
  </div>

  <!-- RESUMO POR KM -->
  <div class="card">
    <h2>Custo Real por KM</h2>
    <div class="row"><span>Combustível / KM</span><strong id="combKm">–</strong></div>
    <div class="row"><span>Despesas / KM</span><strong id="despKm">–</strong></div>
    <div class="row"><span><strong>Custo total / KM</strong></span><strong id="totalKm">–</strong></div>
  </div>

  <!-- IA VEICULAR -->
  <div class="card">
    <h2>IA • Diagnóstico do Veículo</h2>
    <div id="ia"></div>
  </div>

</main>

<footer>
  <a href="index.html" style="color:#f5c542;text-decoration:none">← Voltar ao Dashboard</a>
</footer>

<script>
const $ = id => document.getElementById(id);
const getArr = k => JSON.parse(localStorage.getItem(k)||'[]');
const setArr = (k,v) => localStorage.setItem(k, JSON.stringify(v));

function salvarVeiculo(){
  const v={marca:marca.value,modelo:modelo.value,ano:ano.value,km:Number(kmAtual.value)};
  localStorage.setItem('veiculo', JSON.stringify(v));
  gerarIA();
}

function registrarCombustivel(){
  const c={km:Number(kmRodado.value),litros:Number(litros.value),valor:Number(valorComb.value)};
  const arr=getArr('combustivel'); arr.push(c); setArr('combustivel',arr);
  calcularKM(); gerarIA();
}

function registrarDespesa(){
  const d={tipo:tipoDespesa.value,valor:Number(valorDespesa.value),km:Number(kmDespesa.value||0)};
  const arr=getArr('despVeiculo'); arr.push(d); setArr('despVeiculo',arr);
  renderDespesas(); calcularKM(); gerarIA();
}

function renderDespesas(){
  listaDespesas.innerHTML='';
  getArr('despVeiculo').forEach(d=>{
    listaDespesas.innerHTML+=`<li>${d.tipo} • R$ ${d.valor.toFixed(2)}</li>`;
  });
}

function calcularKM(){
  const comb=getArr('combustivel');
  const desp=getArr('despVeiculo');

  const kmTotal = comb.reduce((s,c)=>s+c.km,0);
  const gastoComb = comb.reduce((s,c)=>s+c.valor,0);
  const gastoDesp = desp.reduce((s,d)=>s+d.valor,0);

  if(kmTotal>0){
    const ckm = gastoComb/kmTotal;
    const dkm = gastoDesp/kmTotal;
    combKm.innerText='R$ '+ckm.toFixed(2);
    despKm.innerText='R$ '+dkm.toFixed(2);
    totalKm.innerText='R$ '+(ckm+dkm).toFixed(2);
  }
}

function gerarIA(){
  const v=JSON.parse(localStorage.getItem('veiculo')||'{}');
  const comb=getArr('combustivel');
  const desp=getArr('despVeiculo');

  if(!v.modelo){ ia.innerText='Cadastre o veículo para análises precisas.'; return; }

  let msg = `Veículo ${v.marca} ${v.modelo}. `;

  const kmTotal = comb.reduce((s,c)=>s+c.km,0);
  const litros = comb.reduce((s,c)=>s+c.litros,0);
  const media = litros>0 ? kmTotal/litros : 0;

  if(media && media < 8) msg += 'Consumo elevado. Verifique pneus, filtros e condução.';
  else if(media && media > 12) msg += 'Bom consumo. Condução eficiente.';

  const manut = desp.filter(d=>d.tipo==='manutencao').reduce((s,d)=>s+d.valor,0);
  if(manut > 2000) msg += ' Gastos altos com manutenção. Avalie preventiva.';

  ia.innerText = msg;
}

renderDespesas(); calcularKM(); gerarIA();
</script>

</body>
</html>
